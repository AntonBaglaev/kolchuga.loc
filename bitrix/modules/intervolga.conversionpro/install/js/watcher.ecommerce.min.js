!function(){"use strict";function e(e,n,t){if(this._currency=e,"string"!=typeof this._currency||0===this._currency.length)throw new Error("Wrong base currency");if(this._containerName=n,"string"!=typeof this._containerName||0===this._containerName.length)throw new Error("Wrong data layer name");this._debug=t,this._sent=[],this._inProgress=!1,window.conversionpro_products=window.conversionpro_products||{},window.conversionpro_detail=window.conversionpro_detail||[]}if(!window.BX||!window.BX.ajax)throw new Error("BX.ajax not loaded");e.prototype.check=function(){if(this._inProgress)return void this._debug("Product detail <-- blocked");this._inProgress=!0,this._debug("Product detail --> started check"),this._debug("Product detail --- check list");for(var e=0;e<window.conversionpro_detail.length;e++){var n=window.conversionpro_detail[e],t=window.conversionpro_products[n];if(this._sent.indexOf(n)===-1){t?(this._debug("Product detail --- product "+n+" found"),this._debug(t)):this._debug("Product detail --- product "+n+" not found");var i={event:"ivcp.detail_viewed",ecommerce:{currencyCode:this._currency,detail:{products:[t]}}};try{window[this._containerName].push(i),this._sent.push(n),this._debug("Product detail --- event was sent")}catch(o){this._debug("Product detail --- error while sending "+o.message)}}else this._debug("Product detail --- product "+n+" was processed earlier")}this._debug("Product detail --- clean list");for(var r=0;r<this._sent.length;r++){var c=window.conversionpro_detail.indexOf(this._sent[r]);-1!==c&&window.conversionpro_detail.splice(c,1)}this._debug("Product detail <-- finished check"),this._inProgress=!1},BX.addCustomEvent("onConversionProReady",function(n,t){t("EC --> started settings check");var i=parseInt(n.metrika_id);i>0&&window["yaCounter"+i]?(t(window["yaCounter"+i]._ecommerce?'EC --- option "ecommerce" enabled in Yandex.Metrika counter '+i:'EC --- option "ecommerce" not enabled in Yandex.Metrika counter '+i),t(window["yaCounter"+i]._ecommerce!==n.container_name?"EC --- incorrect data layer name in Yandex.Metrika counter "+i:"EC --- correct data layer name in Yandex.Metrika counter "+i)):t("EC --- Yandex.Metrika counter not found or not specified in settings");var o=n.analytics_id;if(o&&o.length>0&&window.ga&&window.ga.getAll){for(var r=ga.getAll(),c=null,d=0;d<r.length;d++)r[d].get("trackingId")===o&&(c=r[d]);c?(t('EC --- loading "ec" module for Universal Analytics'),ga("require","ec")):t("EC --- Universal Analytics counter not found")}else t("EC --- Universal Analytics counter not found or not specified in settings");t("EC <-- finished settings check");var s=new e(n.base_currency,n.container_name,t);s.check(),BX.addCustomEvent("onConversionProDetailShown",function(){s.check()})})}();
//# sourceMappingURL=watcher.ecommerce.min.js.map